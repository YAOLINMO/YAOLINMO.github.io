<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èµ›åšç©ºé—´ç«™</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;700&display=swap" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
  <style>
    /* æ–°å¢çš„éœ“è™¹ç¯æ•ˆæœ */
    .cyber-header h1 {
      text-shadow: 0 0 10px #00f0ff, 0 0 20px #00f0ff;
      animation: glow 1.5s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 10px #00f0ff; }
      to { text-shadow: 0 0 20px #00f0ff, 0 0 30px #00f0ff; }
    }
  </style>
</head>
<body>
  <div class="cyber-container">
    <!-- å¢å¼ºçš„å¤´éƒ¨åŒºåŸŸ -->
    <header class="cyber-header">
      <div class="avatar-container">
        <img src="{{ url_for('static', filename='images/avatar.jpg') }}" class="cyber-avatar">
        <div class="online-status"></div>
      </div>
      <h1 class="glitch" data-text="èµ›åšç©ºé—´ç«™">èµ›åšç©ºé—´ç«™</h1>
      <p class="cyber-subtitle">æ•°å­—ä¸–ç•Œçš„æ ¸å¿ƒæ¢çº½</p>
      <div class="cyber-stats">
        <span>ç”¨æˆ·: {{ current_user }}</span>
        <span>åº”ç”¨: {{ apps|length }}</span>
        <span>åª’ä½“: {{ media_files|length }}</span>
      </div>
    </header>

    <!-- æ¶ˆæ¯é—ªç°åŒºå¢å¼º -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="cyber-alert-container">
          {% for category, message in messages %}
            <div class="cyber-alert {{ category }}">
              <span class="alert-icon">âš ï¸</span>
              <p>{{ message }}</p>
              <span class="alert-close">&times;</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- å¢å¼ºçš„åº”ç”¨ä¸‹è½½åŒº -->
    <section class="cyber-section app-section">
      <div class="section-header">
        <h2><span class="neon-accent">#</span> åº”ç”¨ä¸­å¿ƒ</h2>
        <div class="section-actions">
          <button class="cyber-button small" id="refresh-apps">
            <span class="icon">âŸ³</span> åˆ·æ–°
          </button>
        </div>
      </div>
      
      <form method="post" action="/upload/app" enctype="multipart/form-data" class="cyber-form upload-form">
        <div class="file-upload-wrapper">
          <input type="file" name="file" id="app-upload" accept=".apk,.ipa,.exe,.dmg,.deb" required>
          <label for="app-upload" class="file-upload-label">
            <span class="icon">ğŸ“</span>
            <span class="text">é€‰æ‹©åº”ç”¨æ–‡ä»¶</span>
          </label>
        </div>
        <button type="submit" class="cyber-button primary">
          <span class="icon">â†‘</span> ä¸Šä¼ åº”ç”¨
        </button>
      </form>
      
      {% if apps %}
      <div class="cyber-grid">
        {% for app in apps %}
        <div class="cyber-card app-card">
          <div class="file-icon" data-type="{{ app.type|upper }}"></div>
          <div class="file-info">
            <h3 title="{{ app.name }}">{{ app.name|truncate(20) }}</h3>
            <div class="file-meta">
              <span class="size">{{ app.size }}</span>
              <span class="date">{{ app.date }}</span>
            </div>
            <div class="file-actions">
              <a href="{{ url_for('download', filetype='app', filename=app.name) }}" 
                 class="cyber-download-btn">
                <span class="icon">â†“</span> ä¸‹è½½
              </a>
              <button class="cyber-small-btn info" onclick="showDetails('{{ app.name }}')">
                <span class="icon">i</span> è¯¦æƒ…
              </button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <img src="{{ url_for('static', filename='images/empty-apps.png') }}" alt="æ— åº”ç”¨">
        <p>æš‚æ— åº”ç”¨æ–‡ä»¶ï¼Œè¯·ä¸Šä¼ </p>
      </div>
      {% endif %}
    </section>

    <!-- å¢å¼ºçš„åª’ä½“åº“ -->



    <section class="cyber-section media-section">
      <div class="section-header">
        <h2><span class="neon-accent">></span> åª’ä½“åº“</h2>
        <div class="section-actions">
          <div class="view-toggle">
            <button class="cyber-button small active" data-view="grid">ç½‘æ ¼</button>
            <button class="cyber-button small" data-view="list">åˆ—è¡¨</button>
          </div>
        </div>
      </div>
      
      <form method="post" action="/upload/media" enctype="multipart/form-data" class="cyber-form upload-form">
        <div class="file-upload-wrapper">
          <input type="file" name="file" id="media-upload" accept="video/*,image/*" required multiple>
          <label for="media-upload" class="file-upload-label">
            <span class="icon">ğŸ¬</span>
            <span class="text">é€‰æ‹©åª’ä½“æ–‡ä»¶</span>
          </label>
        </div>
        <button type="submit" class="cyber-button primary">
          <span class="icon">â†‘</span> ä¸Šä¼ åª’ä½“
        </button>
      </form>
      
      {% if media_files %}
      <div class="media-grid" id="media-view">
        {% for item in media_files %}
          {% if item.type in ['mp4','webm','ogg'] %}
            <div class="media-card video-card">
              <div class="media-preview">
                <video>
                  <source src="{{ url_for('static', filename='videos/' + item.name) }}" 
                          type="video/{{ item.type }}">
                </video>
                <button class="play-button">â–¶</button>
              </div>
              <div class="media-meta">
                <h3 title="{{ item.name }}">{{ item.name|truncate(25) }}</h3>
                <div class="media-info">
                  <span class="type">{{ item.type|upper }}</span>
                  <span class="size">{{ item.size }}</span>
                </div>
                <div class="media-actions">
                  <a href="{{ url_for('download', filetype='media', filename=item.name) }}"
                     class="cyber-small-btn">
                    <span class="icon">â†“</span> ä¸‹è½½
                  </a>
                  <button class="cyber-small-btn" onclick="previewMedia('{{ item.name }}')">
                    <span class="icon">ğŸ‘ï¸</span> é¢„è§ˆ
                  </button>
                </div>
              </div>
            </div>
          {% else %}
            <div class="media-card image-card">
              <div class="media-preview">
                <img src="{{ url_for('static', filename='videos/' + item.name) }}" 
                     alt="{{ item.name }}" loading="lazy">
                <button class="view-button">ğŸ”</button>
              </div>
              <div class="media-meta">
                <h3 title="{{ item.name }}">{{ item.name|truncate(25) }}</h3>
                <div class="media-info">
                  <span class="type">{{ item.type|upper }}</span>
                  <span class="size">{{ item.size }}</span>
                </div>
                <div class="media-actions">
                  <a href="{{ url_for('download', filetype='media', filename=item.name) }}"
                     class="cyber-small-btn">
                    <span class="icon">â†“</span> ä¸‹è½½
                  </a>
                  <button class="cyber-small-btn" onclick="previewMedia('{{ item.name }}')">
                    <span class="icon">ğŸ‘ï¸</span> é¢„è§ˆ
                  </button>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <img src="{{ url_for('static', filename='images/empty-media.png') }}" alt="æ— åª’ä½“">
        <p>æš‚æ— åª’ä½“æ–‡ä»¶ï¼Œè¯·ä¸Šä¼ </p>
      </div>
      {% endif %}
    </section>

    <!-- é¡µè„š -->
    <footer class="cyber-footer">
      <p>Â© 2025 èµ›åšç©ºé—´ç«™ | ç‰ˆæœ¬ 1.0.0</p>
      <div class="footer-links">
        <a href="#">ä½¿ç”¨æ¡æ¬¾</a>
        <a href="#">éšç§æ”¿ç­–</a>
        <a href="#">è”ç³»æˆ‘ä»¬</a>
      </div>
    </footer>
  </div>

  <!-- JavaScript -->
  <script>
    // æ’­æ”¾è§†é¢‘é¢„è§ˆ
    document.querySelectorAll('.play-button').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const video = e.target.closest('.media-preview').querySelector('video');
        video.requestFullscreen();
        video.play();
      });
    });

    // åˆ‡æ¢è§†å›¾æ¨¡å¼
    document.querySelectorAll('[data-view]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('media-view').className = `media-${btn.dataset.view}`;
        document.querySelectorAll('[data-view]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // åˆ·æ–°åº”ç”¨åˆ—è¡¨
    document.getElementById('refresh-apps').addEventListener('click', () => {
      window.location.reload();
    });
  </script>
</body>
</html>